#!/bin/sh

if [ "X$1" = "Xstart" ]; then
  # Init framebuffers
  echo 1 > /sys/class/graphics/fb0/blank
  echo 1 > /sys/class/graphics/fb1/blank
  # Clear framebuffers
  dd if=/dev/zero of=/dev/fb0 bs=1024 count=1200
  dd if=/dev/zero of=/dev/fb1 bs=1024 count=1200
  # Bugfix for M3/M6 kernel, init fb0 to 24 bpp first
  # or the init to 32 bpp will not work
  fbset -fb /dev/fb0 -g 1024 600 1024 1200 24
  # Setup the default fb sizes, bbp and buffering
  fbset -fb /dev/fb0 -g 1024 600 1024 1200 32
  fbset -fb /dev/fb1 -g 1024 600 1024 1200 32
  # Display splash image
  lzopcat /usr/share/splash/starting.fb.lzo > /dev/fb0
  echo 0 > /sys/class/graphics/fb0/blank
fi
